# MIPSLAB

Computer orgnization courseworks in XJTU.

By Junyang Zhang.

## Simulation

The project has a testbench also written in Verilog HDL, thus using any simulator other than [Verilator](https://www.veripool.org/verilator/) would be suffice. It is recommended to use [Icarus Verilog](http://iverilog.icarus.com/) as a simulator, and other platforms such as [Modelsim](https://eda.sw.siemens.com/en-US/ic/modelsim/), [Vivado](https://china.xilinx.com/products/design-tools/vivado.html), [Quartus](https://www.intel.com/content/www/us/en/software/programmable/quartus-prime/download.html) are yet to be tested.

### Installing Icarus Verilog

It is recommended to work with Linux or Unix-like systems. If you wish to install Icarus Verilog in Windows (without WSL), please do some research.

In MacOS: ([Homebrew](https://brew.sh/))

```sh
brew install iverilog
```

In Debian based distributions: ([apt-get](https://www.debian.org/doc/manuals/debian-handbook/sect.apt-get.zh-cn.html))

```sh
sudo apt-get iverilog
```

### Running simulation

First, clone this repository and `cd` into it.

```sh
git clone https://github.com/James-Hen/MIPSLAB.git
cd MIPSLAB
```

I wrote a handy make script to simulate and generate waveforms.

```sh
make
```

Then the vvp files and waveforms of all targets will be generated in `target/`. Read the waveform with [GTKWave](http://gtkwave.sourceforge.net/), [WaveTrace](https://www.wavetrace.io/), etc.

The target can be selected to build such as `make single_cycle`, `make multicycle`, `make pipeline`.

## Testing

Currently, no auto testing scripts of MIPS ISA are deployed. But anyone could run the processor with their self-written assembly language text and data, generated by [MARS](http://courses.missouristate.edu/kenvollmar/mars/). Please assemble the `.asm` files and load the `.text` segment into `sim/imem.text`, and `.data` segment into `sim/dmem.data`, as hexadecimal text files. The simulatior will read those files and load them into the debug memories.

Some handy assembly programs are given in `sim/MIPS_sample_src`.

## Architecture Overview

The projects now includes four CPU implementation with different architectures, have a quick look to see what will happen.

### Single Cycle CPU

The single cycle version is the basis of all variants, which consists of all necessary components. The datapath is illustrated below.

![SingleCycleDataPath.drawio](assets/SingleCycleDataPath.drawio.png)

As you can see, the diagram is splitted into 5 stages, which will run in turns by each clock signal. On every positive edge of the clock signal, there would be exactly one stage that is active. This counting is implemented by a counter in `common/single_cycle/counter.v`, which sends out 5 different sub-clock signals.
